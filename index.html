<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>yestodmorrow kk â€” gentle compare</title>
  <style>
    :root{
      --bg:#ffffff; --fg:#0b1020; --muted:#6b7280; --line:#e6e9ef; --card:#f8fafc;
      --accent:#2563eb; --good:#10b981; --warn:#ef4444;
      --chip:#eef2ff; --chipText:#374151;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans KR","Noto Sans JP",sans-serif;background:var(--bg);color:var(--fg)}
    .wrap{height:100vh;display:grid;grid-template-rows:auto 1fr auto;max-width:780px;margin:0 auto;padding:14px;gap:10px}
    header,footer{display:flex;align-items:center;justify-content:space-between}
    header .brand{display:flex;align-items:center;gap:8px}
    .badge{border:1px solid var(--line);padding:2px 8px;border-radius:999px;font-size:12px;color:var(--accent)}
    .loc{font-weight:700}
    .muted{color:var(--muted)}
    .small{font-size:12px}
    .btn{border:1px solid var(--line);background:#fff;padding:6px 10px;border-radius:8px;font-size:12px;cursor:pointer}
    .lang button{border:1px solid var(--line);background:#fff;padding:6px 10px;border-radius:999px;font-size:12px;margin-left:6px;cursor:pointer}
    .lang button.active{border-color:var(--accent);color:var(--accent);font-weight:700}
    main{display:grid;grid-template-rows:auto auto auto 1fr;gap:10px;overflow:auto}
    .headline{border:1px solid var(--line);border-radius:12px;padding:12px;background:#fff;font-size:16px;line-height:1.5}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:var(--chip); color:var(--chipText); padding:4px 10px; border-radius:999px; font-size:12px; border:1px solid #e5e7eb}
    .grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
    .slot{border:1px dashed var(--line);border-radius:12px;padding:10px;background:#fff}
    .slot h4{margin:0 0 6px 0;font-size:12px;color:var(--muted)}
    .slot .line{font-size:14px}
    .cards{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:12px;padding:10px;display:flex;flex-direction:column;gap:6px}
    .card h3{margin:0 0 2px 0;font-size:12px;color:var(--muted);font-weight:700}
    .big{font-size:22px;font-weight:800}
    .row{display:flex;justify-content:space-between;font-size:13px}
    .tips{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .pill{border:1px solid var(--line);background:#fff;padding:6px 10px;border-radius:999px;font-size:12px}
    footer .right{display:flex;align-items:center;gap:8px}
    a { color: inherit; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <span class="badge">yestodmorrow kk</span>
        <div>
          <div class="loc" id="locText">Seoul</div>
          <div class="muted small" id="timeText"></div>
        </div>
      </div>
      <div style="display:flex;align-items:center;gap:6px">
        <button class="btn" id="locBtn">ğŸ“ ìœ„ì¹˜ ì¬ì„¤ì •</button>
        <div class="lang">
          <button data-lang="ko" class="active">KO</button>
          <button data-lang="en">EN</button>
          <button data-lang="ja">JA</button>
        </div>
      </div>
    </header>

    <!-- Warm friendly headlines -->
    <div class="headline" id="headline1">ì˜¤ëŠ˜ ëŠë‚Œì„ ê³„ì‚° ì¤‘ì´ì—ìš”â€¦</div>
    <div class="headline" id="headline2">ë‚´ì¼ ê¸°ë¶„ë„ ì‚´ì§ ì˜ˆì¸¡í•´ë³¼ê²Œìš”â€¦</div>

    <!-- Moved up: time slots summary (Today first; Tomorrow preview under each) -->
    <div class="grid3">
      <div class="slot">
        <h4 id="amLbl">ì•„ì¹¨(6â€“9)</h4>
        <div class="line" id="amLine">â€”</div>
        <div class="chips" id="amChips"></div>
        <div class="small muted" id="amTom">ë‚´ì¼: â€”</div>
      </div>
      <div class="slot">
        <h4 id="noonLbl">ì ì‹¬(12â€“15)</h4>
        <div class="line" id="noonLine">â€”</div>
        <div class="chips" id="noonChips"></div>
        <div class="small muted" id="noonTom">ë‚´ì¼: â€”</div>
      </div>
      <div class="slot">
        <h4 id="eveLbl">ì €ë…(18â€“21)</h4>
        <div class="line" id="eveLine">â€”</div>
        <div class="chips" id="eveChips"></div>
        <div class="small muted" id="eveTom">ë‚´ì¼: â€”</div>
      </div>
    </div>

    <!-- Smaller detail cards -->
    <div class="cards">
      <div class="card">
        <h3 id="yTitle">ì–´ì œ ì´ ì‹œê°„</h3>
        <div class="big" id="yTemp">â€”</div>
        <div class="row"><span id="yRainLbl">ê°•ìˆ˜</span><span id="yRain">â€”</span></div>
        <div class="row"><span id="yWindLbl">ë°”ëŒ</span><span id="yWind">â€”</span></div>
      </div>
      <div class="card">
        <h3 id="tTitle">ì˜¤ëŠ˜ ì§€ê¸ˆ</h3>
        <div class="big" id="tTemp">â€”</div>
        <div class="chips" id="nowChips"></div>
        <div class="row"><span id="tRainLbl">ê°•ìˆ˜</span><span id="tRain">â€”</span></div>
        <div class="row"><span id="tWindLbl">ë°”ëŒ</span><span id="tWind">â€”</span></div>
      </div>
    </div>

    <footer>
      <div class="tips">
        <span class="pill" id="tip1">â˜‚ ìš°ì‚° í•„ìš” ì—†ìŒ</span>
        <span class="pill" id="tip2">ğŸ§¥ ê²‰ì˜· ì„ íƒ</span>
        <span class="pill" id="tip3">â˜€ ìì™¸ì„  ì£¼ì˜</span>
      </div>
      <div class="right small muted">Data: Open-Meteo â€¢ v0.3 (friendly)</div>
    </footer>
  </div>

  <script>
    // === ì‰¬ìš´ ìš©ì–´ ===
    // API: ë°ì´í„°ë¥¼ ì£¼ëŠ” ì„œë²„ ì£¼ì†Œ. fetch(): ê·¸ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ëŠ” ëª…ë ¹.
    // JSON: ì„œë²„ê°€ ë³´ë‚´ëŠ” í‘œ í˜•íƒœì˜ í…ìŠ¤íŠ¸.
    // timezone=auto: í˜„ì§€ ì‹œê°„ìœ¼ë¡œ ìë™ ë³€í™˜.

    const texts = {
      ko: {
        yTitle: "ì–´ì œ ì´ ì‹œê°„", tTitle: "ì˜¤ëŠ˜ ì§€ê¸ˆ",
        am: "ì•„ì¹¨(6â€“9)", noon: "ì ì‹¬(12â€“15)", eve: "ì €ë…(18â€“21)",
        rain: "ê°•ìˆ˜", wind: "ë°”ëŒ",
        // ì¹œì ˆí•œ í—¤ë“œë¼ì¸ ë¬¸êµ¬
        warmToday: (tempTone, rainTone, windTone)=> {
          const bits = [];
          if (tempTone==='warmer') bits.push("ì˜¤ëŠ˜ì€ ì–´ì œë³´ë‹¤ ì¡°ê¸ˆ ë” ë”°ëœ»í•´ìš”");
          else if (tempTone==='cooler') bits.push("ì˜¤ëŠ˜ì€ ì–´ì œë³´ë‹¤ ì‚´ì§ ì„œëŠ˜í•´ìš”");
          else bits.push("ì˜¤ëŠ˜ì€ ì–´ì œì™€ ëŠë‚Œì´ ë¹„ìŠ·í•´ìš”");
          if (rainTone==='more') bits.push("ë¹„ ì†Œì‹ì´ ì¡°ê¸ˆ ë” ìˆì–´ìš”");
          else if (rainTone==='less') bits.push("ë¹„ ê±±ì •ì€ ëœí•´ìš”");
          if (windTone==='more') bits.push("ë°”ëŒì€ ì˜¤ëŠ˜ì´ ì¢€ ë” ë„ë“œë¼ì ¸ìš”");
          if (windTone==='less') bits.push("ë°”ëŒì€ ì˜¤ëŠ˜ì´ í•œê²° ì¦ì•„ìš”");
          bits.push("ê°€ë²¼ìš´ í•˜ë£¨ê°€ ë˜ê¸¸ ë°”ë„ê²Œìš” â˜•");
          return bits.join(" Â· ");
        },
        warmTomorrow: (tempTone, rainTone)=> {
          const bits = [];
          if (tempTone==='warmer') bits.push("ë‚´ì¼ì€ ì˜¤ëŠ˜ë³´ë‹¤ ë” í¬ê·¼í•  ë“¯í•´ìš”");
          else if (tempTone==='cooler') bits.push("ë‚´ì¼ì€ ì˜¤ëŠ˜ë³´ë‹¤ ì¡°ê¸ˆ ë” ì„ ì„ í•´ì§ˆ ê±°ì˜ˆìš”");
          else bits.push("ë‚´ì¼ë„ ì˜¤ëŠ˜ê³¼ ë¹„ìŠ·í•œ ëŠë‚Œì´ì—ìš”");
          if (rainTone==='more') bits.push("ìš°ì‚°ì„ ì‚´ì§ ì±™ê²¨ë‘ë©´ ë“ ë“ í•˜ê² ì–´ìš”");
          else if (rainTone==='less') bits.push("ë¹„ ê±±ì •ì€ ì˜¤ëŠ˜ë³´ë‹¤ ì¤„ì–´ë“¤ê² ì–´ìš”");
          return bits.join(" Â· ");
        },
        chips: {
          warmer: "ë” ë”°ëœ»", cooler: "ì„œëŠ˜", same: "ë¹„ìŠ·",
          rainHigh: "ë¹„ ê°€ëŠ¥ì„± ë†’ìŒ", rainMid: "ë¹„ ê°€ëŠ¥ì„± ë³´í†µ", rainLow: "ë¹„ ê°€ëŠ¥ì„± ë‚®ìŒ",
          windHigh: "ë°”ëŒ ê°•í•¨", windMid: "ë°”ëŒ ë³´í†µ", windLow: "ë°”ëŒ ì•½í•¨"
        },
        tips: { noUmb:"â˜‚ ìš°ì‚° í•„ìš” ì—†ìŒ", takeUmb:"â˜‚ ìš°ì‚° ì±™ê¸°ê¸°", outerMaybe:"ğŸ§¥ ê²‰ì˜· ì„ íƒ", outerNeed:"ğŸ§¥ ê²‰ì˜· í•„ìš”", uv:"â˜€ ìì™¸ì„  ì£¼ì˜" },
        resetLoc:"ğŸ“ ìœ„ì¹˜ ì¬ì„¤ì •",
        loading1:"ì˜¤ëŠ˜ ëŠë‚Œì„ ê³„ì‚° ì¤‘ì´ì—ìš”â€¦",
        loading2:"ë‚´ì¼ ê¸°ë¶„ë„ ì‚´ì§ ì˜ˆì¸¡í•´ë³¼ê²Œìš”â€¦"
      },
      en: {
        yTitle: "This hour yesterday", tTitle: "Now today",
        am: "Morning (6â€“9)", noon: "Noon (12â€“15)", eve: "Evening (18â€“21)",
        rain: "Precip", wind: "Wind",
        warmToday: (tempTone, rainTone, windTone)=> {
          const bits = [];
          if (tempTone==='warmer') bits.push("Today feels a touch warmer than yesterday");
          else if (tempTone==='cooler') bits.push("Today feels a bit cooler than yesterday");
          else bits.push("Today feels about the same as yesterday");
          if (rainTone==='more') bits.push("Slightly higher chance of rain");
          else if (rainTone==='less') bits.push("Less worry about rain");
          if (windTone==='more') bits.push("A bit breezier today");
          if (windTone==='less') bits.push("Winds look calmer");
          bits.push("Hope your day feels gentle â˜•");
          return bits.join(" Â· ");
        },
        warmTomorrow: (tempTone, rainTone)=> {
          const bits = [];
          if (tempTone==='warmer') bits.push("Tomorrow looks warmer than today");
          else if (tempTone==='cooler') bits.push("Tomorrow may feel a little cooler");
          else bits.push("Tomorrow should feel similar to today");
          if (rainTone==='more') bits.push("An umbrella might be handy");
          else if (rainTone==='less') bits.push("Less chance of rain than today");
          return bits.join(" Â· ");
        },
        chips: {
          warmer: "warmer", cooler: "cooler", same: "similar",
          rainHigh: "rain likely", rainMid: "rain possible", rainLow: "rain low",
          windHigh: "windy", windMid: "breezy", windLow: "calm"
        },
        tips: { noUmb:"â˜‚ No umbrella", takeUmb:"â˜‚ Take umbrella", outerMaybe:"ğŸ§¥ Light layer", outerNeed:"ğŸ§¥ Bring a jacket", uv:"â˜€ UV caution" },
        resetLoc:"ğŸ“ Reset location",
        loading1:"Crunching today's feelâ€¦",
        loading2:"Peeking at tomorrowâ€¦"
      },
      ja: {
        yTitle: "æ˜¨æ—¥ã®ã“ã®æ™‚é–“", tTitle: "ä»Šæ—¥ãƒ»ä»Š",
        am: "æœ(6â€“9)", noon: "æ˜¼(12â€“15)", eve: "å¤•(18â€“21)",
        rain: "é™æ°´", wind: "é¢¨",
        warmToday: (tempTone, rainTone, windTone)=> {
          const bits = [];
          if (tempTone==='warmer') bits.push("ä»Šæ—¥ã¯æ˜¨æ—¥ã‚ˆã‚Šå°‘ã—æš–ã‹ãæ„Ÿã˜ãã†");
          else if (tempTone==='cooler') bits.push("ä»Šæ—¥ã¯æ˜¨æ—¥ã‚ˆã‚Šå°‘ã—æ¶¼ã—ãæ„Ÿã˜ãã†");
          else bits.push("ä»Šæ—¥ã¯æ˜¨æ—¥ã¨ä½“æ„ŸãŒã»ã¼åŒã˜");
          if (rainTone==='more') bits.push("é›¨ã®å¯èƒ½æ€§ã¯ã‚„ã‚„é«˜ã‚");
          else if (rainTone==='less') bits.push("é›¨ã®å¿ƒé…ã¯å°‘ãªã‚");
          if (windTone==='more') bits.push("é¢¨ã¯å°‘ã—å¼·ã‚");
          if (windTone==='less') bits.push("é¢¨ã¯è½ã¡ç€ããã†");
          bits.push("ç©ã‚„ã‹ãªä¸€æ—¥ã«ãªã‚Šã¾ã™ã‚ˆã†ã« â˜•");
          return bits.join("ãƒ»");
        },
        warmTomorrow: (tempTone, rainTone)=> {
          const bits = [];
          if (tempTone==='warmer') bits.push("æ˜æ—¥ã¯ä»Šæ—¥ã‚ˆã‚Šæš–ã‹ããªã‚Šãã†");
          else if (tempTone==='cooler') bits.push("æ˜æ—¥ã¯ä»Šæ—¥ã‚ˆã‚Šå°‘ã—æ¶¼ã—ãã†");
          else bits.push("æ˜æ—¥ã‚‚ä»Šæ—¥ã¨åŒã˜ãã‚‰ã„");
          if (rainTone==='more') bits.push("å‚˜ãŒã‚ã‚‹ã¨å®‰å¿ƒ");
          else if (rainTone==='less') bits.push("é›¨ã®å¿ƒé…ã¯ä»Šæ—¥ã‚ˆã‚Šå°‘ãªã‚");
          return bits.join("ãƒ»");
        },
        chips: {
          warmer: "æš–ã‹ã„", cooler: "æ¶¼ã—ã„", same: "ã»ã¼åŒã˜",
          rainHigh: "é›¨ å¯èƒ½æ€§é«˜ã„", rainMid: "é›¨ å¯èƒ½æ€§ã‚ã‚Š", rainLow: "é›¨ ä½ã„",
          windHigh: "é¢¨ å¼·ã‚", windMid: "é¢¨ ã‚„ã‚„", windLow: "é¢¨ å¼±ã„"
        },
        tips: { noUmb:"â˜‚ å‚˜ä¸è¦", takeUmb:"â˜‚ å‚˜ã‚’æŒã¤", outerMaybe:"ğŸ§¥ ä¸Šç€ãŠå¥½ã¿ã§", outerNeed:"ğŸ§¥ ä¸Šç€ãŒå¿…è¦", uv:"â˜€ ç´«å¤–ç·šæ³¨æ„" },
        resetLoc:"ğŸ“ å†è¨­å®š",
        loading1:"ä»Šæ—¥ã®ä½“æ„Ÿã‚’è¨ˆç®—ä¸­â€¦",
        loading2:"æ˜æ—¥ã®æ°—é…ã‚’ã®ããè¦‹â€¦"
      }
    };

    let LANG='ko';
    const $ = (id)=>document.getElementById(id);
    const ui = {
      locText:$("locText"), timeText:$("timeText"),
      headline1:$("headline1"), headline2:$("headline2"),
      yTitle:$("yTitle"), tTitle:$("tTitle"),
      yTemp:$("yTemp"), yRain:$("yRain"), yWind:$("yWind"),
      tTemp:$("tTemp"), tRain:$("tRain"), tWind:$("tWind"),
      amLbl:$("amLbl"), noonLbl:$("noonLbl"), eveLbl:$("eveLbl"),
      amLine:$("amLine"), noonLine:$("noonLine"), eveLine:$("eveLine"),
      amChips:$("amChips"), noonChips:$("noonChips"), eveChips:$("eveChips"),
      amTom:$("amTom"), noonTom:$("noonTom"), eveTom:$("eveTom"),
      tip1:$("tip1"), tip2:$("tip2"), tip3:$("tip3"),
      locBtn:$("locBtn")
    };

    document.querySelectorAll('.lang button').forEach(btn=>{
      btn.addEventListener('click',()=>{
        document.querySelectorAll('.lang button').forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        LANG = btn.dataset.lang;
        renderTextsOnly();
      });
    });

    ui.locBtn.addEventListener('click', ()=>{
      navigator.geolocation.getCurrentPosition(async pos=>{
        await loadAll(pos.coords.latitude, pos.coords.longitude);
      }, async err=>{
        alert(LANG==='ko'?'ìœ„ì¹˜ ê¶Œí•œ ì‹¤íŒ¨. ì„œìš¸ë¡œ í‘œì‹œí•©ë‹ˆë‹¤.':LANG==='ja'?'ä½ç½®æƒ…å ±ã®è¨±å¯ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ã‚½ã‚¦ãƒ«ã‚’è¡¨ç¤ºã—ã¾ã™ã€‚':'Location permission failed. Falling back to Seoul.');
        await loadAll(37.5665,126.9780);
      }, {enableHighAccuracy:false, timeout:4000});
    });

    // ====== ìœ í‹¸ ======
    function toneDelta(d){ if (d==null) return 'same'; if (Math.abs(d)<1) return 'same'; return d>0?'warmer':'cooler'; }
    function rainTone(pop){ if (pop==null) return 'rainMid'; if (pop>=60) return 'rainHigh'; if (pop<=25) return 'rainLow'; return 'rainMid'; }
    function windTone(w){ if (w==null) return 'windMid'; if (w>=7) return 'windHigh'; if (w<=3) return 'windLow'; return 'windMid'; }
    function fmtTemp(v){ return (v!=null && isFinite(v)) ? `${Math.round(v)}Â°C` : 'â€”'; }
    function fmtPop(v){ if (v==null || !isFinite(v)) return 'â€”'; return `${Math.round(v)}%`; }
    function fmtMm(v){ if (v==null || !isFinite(v)) return 'â€”'; if (v < 0.1) return '0 mm'; return `${(Math.round(v*10)/10).toFixed(1)} mm`; }
    function avgForHours(values, times, dateBase, hours){
      const y = dateBase.getFullYear();
      const m = (dateBase.getMonth()+1).toString().padStart(2,'0');
      const d = dateBase.getDate().toString().padStart(2,'0');
      const prefix = `${y}-${m}-${d}T`;
      let acc=0, cnt=0;
      for (const h of hours){
        const key = `${prefix}${h.toString().padStart(2,'0')}:00`;
        const idx = times.indexOf(key);
        if (idx>=0 && values[idx]!=null){ acc += values[idx]; cnt++; }
      }
      return cnt? acc/cnt : null;
    }

    // ====== ìƒíƒœ ======
    let ST = {
      lat: 37.5665, lon: 126.9780,
      locName: 'Seoul',
      now: new Date(),
      time: [],
      series: null,
      today: null, yesterday: null, tomorrow: null
    };

    async function reverseGeocode(lat, lon){
      try{
        const url = `https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=${LANG}&format=json`;
        const r = await fetch(url); const j = await r.json();
        if (j && j.results && j.results.length){
          const top = j.results[0];
          const parts = [top.city || top.name, top.admin1, top.country_code].filter(Boolean);
          return parts.join(', ');
        }
      }catch(e){}
      return 'Unknown';
    }

    function summarizeForDate(dateObj){
      const H = ST.series; const time = ST.time;
      const slots = { am:[6,7,8,9], noon:[12,13,14,15], eve:[18,19,20,21] };
      const out = {};
      for (const [key, hours] of Object.entries(slots)){
        out[key] = {
          temp: avgForHours(H.temp, time, dateObj, hours),
          feels: avgForHours(H.feels, time, dateObj, hours),
          pop: avgForHours(H.pop, time, dateObj, hours),
          rain: avgForHours(H.rain, time, dateObj, hours),
          wind: avgForHours(H.wind, time, dateObj, hours),
        };
      }
      // now: ê°™ì€ ë‚ ì§œì—ì„œ í˜„ì¬ì‹œê°ê³¼ ê°€ì¥ ê°€ê¹Œìš´ ê°’ 1ê°œ
      let bestIdx=-1,best=1e9;
      for (let i=0;i<time.length;i++){
        const t = new Date(time[i]);
        if (t.toDateString()!==dateObj.toDateString()) continue;
        const diff = Math.abs(t.getTime()-ST.now.getTime());
        if (diff<best){best=diff; bestIdx=i;}
      }
      out.now = {
        temp: bestIdx>=0? H.temp[bestIdx] : null,
        feels: bestIdx>=0? H.feels[bestIdx] : null,
        pop: bestIdx>=0? H.pop[bestIdx] : null,
        rain: bestIdx>=0? H.rain[bestIdx] : null,
        wind: bestIdx>=0? H.wind[bestIdx] : null,
      };
      return out;
    }

    async function loadAll(lat, lon){
      ST.lat = lat; ST.lon = lon; ST.now = new Date();

      ui.headline1.textContent = texts[LANG].loading1;
      ui.headline2.textContent = texts[LANG].loading2;

      const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}`+
        `&hourly=temperature_2m,apparent_temperature,precipitation_probability,precipitation,wind_speed_10m`+
        `&past_days=1&forecast_days=2&timezone=auto`;
      const res = await fetch(url);
      const f = await res.json();

      ST.time = f.hourly.time;
      ST.series = {
        temp: f.hourly.temperature_2m,
        feels: f.hourly.apparent_temperature,
        pop: f.hourly.precipitation_probability,
        rain: f.hourly.precipitation,
        wind: f.hourly.wind_speed_10m
      };

      const now = ST.now;
      const yday = new Date(now.getTime()-24*60*60*1000);
      const tmr = new Date(now.getTime()+24*60*60*1000);

      ST.yesterday = summarizeForDate(yday);
      ST.today = summarizeForDate(now);
      ST.tomorrow = summarizeForDate(tmr);

      ST.locName = await reverseGeocode(lat, lon);
      renderAll();
    }

    function chip(el, text){
      const span = document.createElement('span');
      span.className = 'chip';
      span.textContent = text;
      el.appendChild(span);
    }

    function renderTextsOnly(){
      // labels
      ui.yTitle.textContent = texts[LANG].yTitle;
      ui.tTitle.textContent = texts[LANG].tTitle;
      ui.amLbl.textContent = texts[LANG].am;
      ui.noonLbl.textContent = texts[LANG].noon;
      ui.eveLbl.textContent = texts[LANG].eve;
      ui.locBtn.textContent = texts[LANG].resetLoc;

      // friendly headlines
      if (ST.today && ST.yesterday){
        const dT = (ST.today.now?.feels ?? ST.today.now?.temp) - (ST.yesterday.now?.feels ?? ST.yesterday.now?.temp);
        const tempTone = toneDelta(dT);
        const rainTone = (ST.today.now?.pop ?? 0) - (ST.yesterday.now?.pop ?? 0);
        const windDiff = (ST.today.now?.wind ?? 0) - (ST.yesterday.now?.wind ?? 0);
        ui.headline1.textContent = texts[LANG].warmToday(
          tempTone,
          Math.abs(rainTone)<10? 'same' : (rainTone>0?'more':'less'),
          Math.abs(windDiff)<1.5? 'same' : (windDiff>0?'more':'less')
        );
      }
      if (ST.tomorrow && ST.today){
        const dT2 = (ST.tomorrow.now?.feels ?? ST.tomorrow.now?.temp) - (ST.today.now?.feels ?? ST.today.now?.temp);
        const tempTone2 = toneDelta(dT2);
        const rainTone2 = (ST.tomorrow.now?.pop ?? 0) - (ST.today.now?.pop ?? 0);
        ui.headline2.textContent = texts[LANG].warmTomorrow(
          tempTone2,
          Math.abs(rainTone2)<10? 'same' : (rainTone2>0?'more':'less')
        );
      }

      ui.locText.textContent = ST.locName || 'Unknown';
      ui.timeText.textContent = new Date().toLocaleString();

      renderBody();
      renderTips();
    }

    function renderBody(){
      // detail cards (smaller)
      ui.yTemp.textContent = fmtTemp(ST.yesterday.now?.feels ?? ST.yesterday.now?.temp);
      ui.yRain.textContent = (ST.yesterday.now?.pop!=null) ? fmtPop(ST.yesterday.now.pop) : fmtMm(ST.yesterday.now?.rain);
      ui.yWind.textContent = (ST.yesterday.now?.wind!=null) ? `${Math.round(ST.yesterday.now.wind)} m/s` : 'â€”';

      ui.tTemp.textContent = fmtTemp(ST.today.now?.feels ?? ST.today.now?.temp);
      ui.tRain.textContent = (ST.today.now?.pop!=null) ? fmtPop(ST.today.now.pop) : fmtMm(ST.today.now?.rain);
      ui.tWind.textContent = (ST.today.now?.wind!=null) ? `${Math.round(ST.today.now.wind)} m/s` : 'â€”';

      // chips (qualitative)
      ui.nowChips.innerHTML = '';
      const tempTone = toneDelta((ST.today.now?.feels ?? ST.today.now?.temp) - (ST.yesterday.now?.feels ?? ST.yesterday.now?.temp));
      chip(ui.nowChips, texts[LANG].chips[tempTone]);
      const rainT = rainTone(ST.today.now?.pop);
      chip(ui.nowChips, texts[LANG].chips[rainT]);
      const windT = windTone(ST.today.now?.wind);
      chip(ui.nowChips, texts[LANG].chips[windT]);

      // slots (today) + tomorrow preview
      function slotLine(y, t){
        const labelT = toneDelta((t?.feels ?? t?.temp) - (y?.feels ?? y?.temp));
        const rainTxt = (t?.pop!=null) ? `${fmtPop(t.pop)}` : `${fmtMm(t?.rain)}`;
        return `${texts[LANG].chips[labelT]} Â· ${rainTxt}`;
      }
      ui.amLine.textContent = slotLine(ST.yesterday.am, ST.today.am);
      ui.noonLine.textContent = slotLine(ST.yesterday.noon, ST.today.noon);
      ui.eveLine.textContent = slotLine(ST.yesterday.eve, ST.today.eve);

      // chips per slot (today)
      function slotChips(el, t){
        el.innerHTML='';
        chip(el, texts[LANG].chips[toneDelta((t?.feels ?? t?.temp) -  (ST.yesterday?.[el.id.replace('Chips','')]?.feels ?? ST.yesterday?.[el.id.replace('Chips','')]?.temp))] || texts[LANG].chips.same);
        chip(el, texts[LANG].chips[rainTone(t?.pop)]);
        chip(el, texts[LANG].chips[windTone(t?.wind)]);
      }
      slotChips(ui.amChips, ST.today.am);
      slotChips(ui.noonChips, ST.today.noon);
      slotChips(ui.eveChips, ST.today.eve);

      function tomLine(t, tm){
        const labelT = toneDelta((tm?.feels ?? tm?.temp) - (t?.feels ?? t?.temp));
        const rainTxt = (tm?.pop!=null) ? `${fmtPop(tm.pop)}` : `${fmtMm(tm?.rain)}`;
        return (LANG==='en'?'Tomorrow: ':(LANG==='ja'?'æ˜æ—¥: ':'ë‚´ì¼: ')) + `${texts[LANG].chips[labelT]} Â· ${rainTxt}`;
      }
      ui.amTom.textContent = tomLine(ST.today.am, ST.tomorrow.am);
      ui.noonTom.textContent = tomLine(ST.today.noon, ST.tomorrow.noon);
      ui.eveTom.textContent = tomLine(ST.today.eve, ST.tomorrow.eve);
    }

    function renderTips(){
      // very simple tips for today
      const umbrella = (ST.today.morning?.pop ?? 0) > 60 || (ST.today.noon?.pop ?? 0) > 60 || (ST.today.eve?.pop ?? 0) > 60 || (ST.today.now?.pop ?? 0) > 60;
      const jacket = (ST.today.morning?.feels ?? 20) < 18 || (ST.today.eve?.feels ?? 20) < 18;
      ui.tip1.textContent = umbrella ? texts[LANG].tips.takeUmb : texts[LANG].tips.noUmb;
      ui.tip2.textContent = jacket ? texts[LANG].tips.outerNeed : texts[LANG].tips.outerMaybe;
      ui.tip3.textContent = texts[LANG].tips.uv;
    }

    async function start(){
      try{
        await new Promise((resolve)=>{
          navigator.geolocation.getCurrentPosition(async pos=>{
            resolve(loadAll(pos.coords.latitude, pos.coords.longitude));
          }, async _=>{
            await loadAll(37.5665,126.9780); // Seoul
            resolve();
          }, {enableHighAccuracy:false, timeout:4000});
        });
      }catch(e){
        await loadAll(37.5665,126.9780);
      }
    }

    start().then(()=>{
      setInterval(()=>{ ui.timeText.textContent = new Date().toLocaleString(); }, 1000*30);
    });

    function renderAll(){ renderTextsOnly(); }
  </script>
</body>
</html>
